{% extends "page.html" %}
{% load webpack_static from webpack_loader %}
{% load crispy_forms_tags %}

{% block breadcrumb %}
<nav class="breadcrumb" aria-label="breadcrumbs">
    <div class="container">
        <ul>
            <li><a href="/">KSICHT</a></li>
            <li class="is-active"><a href="#" aria-current="page">{% block headline %}Aktuální ročník{% if object %} ({{ object }}){% endif %}{% endblock %}</a></li>
        </ul>
    </div>
</nav>
{% endblock %}

{% block article %}
{% if object %}
    <nav class="columns is-multiline">
        <div class="column is-4-tablet is-3-tablet">
            <div>
                <p class="heading">Začíná</p>
                <p class="title is-5"><i class="far fa-calendar-alt has-padding-r-2"></i> {{ object.start_date | date }}</p>
            </div>
        </div>
        <div class="column is-4-tablet is-3-tablet">
            <div>
                <p class="heading">Řešitelé</p>
                <p class="title is-5"><i class="fas fa-user-friends has-padding-r-2"></i> {{ object.applications.count }} přihlášených řešitelů</p>
            </div>
        </div>
        {% if can_apply %}
        <div class="column is-4-tablet">
            <div>
                <p class="heading">Přihláška</p>
                {% crispy application_form %}
            </div>
        </div>
        {% endif %}
    </nav>

    <p class="is-size-5 has-margin-b-5">Každým rokem vyjdou čtyři série KSICHTu. V brožuře vždy naleznete zadání úloh aktuální série, řešení úloh předchozí série a jeden díl seriálu.</p>

    <div class="columns is-desktop">
        {% with object.get_current_series as current_series %}
            {% for series in object.prefetch_series %}
                <div class="column is-one-fourth">
                    <div class="card">
                        <div class="card-content">
                            <h2 class="title is-6 is-uppercase has-text-weight-bold">{{ series }}</h2>
                            <p class="subtitle is-6 has-text-grey">odevzdání do {{ series.submission_deadline | date:"d.m." }}</p>

                            {% with series.tasks.all as tasks %}
                                {% if tasks.count > 0 %}
                                <h2 class="is-size-6 has-text-weight-bold">Úlohy</h2>
                                <ul>
                                    {% for task in tasks %}
                                        <li>{{ task.nr }}. {{ task.title }} <span class="has-text-grey">(max. {{ task.points }} bodů)</span></li>
                                    {% endfor %}
                                </ul>
                                {% endif %}
                            {% endwith %}

                            {% if series.task_file or series.results_published %}
                            <hr class="card-splitter">
                            {% endif %}

                            {% if series.task_file %}
                            <p><a href="{{ series.task_file.url }}" class="has-margin-r-4"><i class="far fa-file-pdf has-padding-r-2"></i> Brožura zadání v PDF</a></p>
                            {% endif %}

                            {% if series.results_published %}
                            <p><a href="{% url "core:series_results" grade_id=series.grade_id pk=series.pk %}" class="has-margin-r-4"><i class="fas fa-trophy has-padding-r-2"></i> Výsledková listina</a></p>
                            {% endif %}
                        </div>
                        {% if series.accepts_solution_submissions and series == current_series and is_grade_participant %}
                        <footer class="card-footer">
                            <p class="card-footer-item">
                                <a href="{% url "core:solution_submit" %}">Odevzdat řešení</a>
                            </p>
                        </footer>
                        {% endif%}
                    </div>
                </div>
            {% endfor %}
        {% endwith %}
    </div>
{% else %}
    <article class="message is-warning is-size-5">
        <div class="message-body">
            <p>Momentálně není žádný ročník KSICHTu vypsán.</p>
        </div>
    </article>
{% endif %}
{% endblock %}
